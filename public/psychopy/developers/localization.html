<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Localization (I18N, translation) &mdash; PsychoPy v1.8-Psychopy教程</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.85.4',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="PsychoPy v1.8" href="../index.html" />
    <link rel="up" title="For Developers" href="developers.html" />
    <link rel="next" title="Adding a new Menu Item" href="menuitem.html" />
    <link rel="prev" title="Style-guide for coder demos" href="demoStyleGuide.html" /> 
  </head>
  <body>


<div id="header"  style="background-color: white">
<table width="100%" cellpadding="10">
<tr><td style="text-align:left;vertical-align:middle">
<a href='/psychopy'><img src="../_static/psychopyDocBanner2.gif" alt="PsychoPy logo" /></a>
</td><td style="text-align:right;vertical-align:middle">
<a href='/psychopy'><img src="../_static/nott_logo.png" alt="University of Nottingham" /></a>
</td></table>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="menuitem.html" title="Adding a new Menu Item"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="demoStyleGuide.html" title="Style-guide for coder demos"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">PsychoPy</a> &raquo;</li>
          <li><a href="../documentation.html" >Documentation</a> &raquo;</li>
          <li><a href="developers.html" accesskey="U">For Developers</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Localization (I18N, translation)</a><ul>
<li><a class="reference internal" href="#make-a-translation-po-file">Make a translation (.po file)</a></li>
<li><a class="reference internal" href="#adjust-psychopy-s-code">Adjust PsychoPy&#8217;s code</a></li>
<li><a class="reference internal" href="#other-notes">Other notes</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="demoStyleGuide.html"
                                  title="previous chapter">Style-guide for coder demos</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="menuitem.html"
                                  title="next chapter">Adding a new Menu Item</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/developers/localization.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>

            <h3>Quick links</h3>
            <ul>
            <li><a href="/2018/03/07/psychopy绿色免安装版下载/"><strong>psychopy免安装版下载</strong></a></li>
            <li><a href="http://mlln.cn">心理学技术讨论群:680552969</a></li>
            <li><a href="http://mlln.cn">站长QQ: 675495787</a></li>
            <li><a href="https://shop68313372.taobao.com/">淘宝店</a></li>
            </ul>

          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="localization-i18n-translation">
<h1>Localization (I18N, translation)<a class="headerlink" href="#localization-i18n-translation" title="Permalink to this headline">¶</a></h1>
<p>PsychoPy is used worldwide. Starting with v1.81, many parts of PsychoPy itself (the app) can be translated into any language that has a unicode character set. A translation affects what the experimenter sees while creating and running experiments; it is completely separate from what is shown to the subject. Translations of the online documentation will need a completely different approach.</p>
<p>In the app, translation is handled by a function, <code class="docutils literal"><span class="pre">_translate()</span></code>, which takes a string argument. (The standard name is <code class="docutils literal"><span class="pre">_()</span></code>, but unfortunately this conflicts with _ as used in some external packages that PsychoPy depends on.) The <code class="docutils literal"><span class="pre">_translate()</span></code> function returns a translated, unicode version of the string in the locale / language that was selected when starting the app. If no translation is available for that locale, the original string is returned (= English).</p>
<p>A locale setting (e.g., &#8216;ja_JP&#8217; for Japanese) allows the end-user (= the experimenter) to control the language that will be used for display within the app itself. (It can potentially control other display conventions as well, not just the language.) PsychoPy will obtain the locale from the user preference (if set), or the OS.</p>
<p>Workflow: 1) Make a translation from English (en_US) to another language. You&#8217;ll need a strong understanding of PsychoPy, English, and the other language. 2) In some cases it will be necessary to adjust PsychoPy&#8217;s code, but only if new code has been added to the app and that code displays text. Then re-do step 1 to translate the newly added strings.</p>
<p>See notes in <code class="docutils literal"><span class="pre">psychopy/app/localization/readme.txt</span></code>.</p>
<div class="section" id="make-a-translation-po-file">
<h2>Make a translation (.po file)<a class="headerlink" href="#make-a-translation-po-file" title="Permalink to this headline">¶</a></h2>
<p>As a translator, you will likely introduce many new people to PsychoPy, and your translations will greatly influence their experience. Try to be completely accurate; it is better to leave something in English if you are unsure how PsychoPy is supposed to work.</p>
<p>To translate a given language, you&#8217;ll need to know the standard 5-character code (see <cite>psychopy/app/localization/mappings</cite>). E.g., for Japanese, wherever LANG appears in the documentation here, you should use the actual code, i.e., &#8220;ja_JP&#8221; (without quotes).</p>
<p>A free app called poedit is useful for managing a translation. For a given language, the translation mappings (from en_US to LANG) are stored in a .po file (a text file with extension <cite>.po</cite>); after editing with poedit, these are converted into binary format (with extension <cite>.mo</cite>) which are used when the app is running.</p>
<ul>
<li><p class="first">Start translation (do these steps once):</p>
<p>Start a translation by opening <cite>psychopy/app/locale/LANG/LC_MESSAGE/messages.po</cite> in Poedit. If there is no such .po file, create a new one:</p>
<blockquote>
<div><ul class="simple">
<li>make a new directory <cite>psychopy/app/locale/LANG/LC_MESSAGE/</cite> if needed. Your <cite>LANG</cite> will be auto-detected within PsychoPy only if you follow this convention. You can copy metadata (such as the project name) from another .po file.</li>
</ul>
</div></blockquote>
<p>Set your name and e-mail address from &#8220;Preferences...&#8221; of &#8220;File&#8221; menu. Set translation properties (such as project name, language and charset) from Catalog Properties Dialog, which can be opened from &#8220;Properties...&#8221; of &#8220;Catalog&#8221; menu.</p>
<p>In poedit&#8217;s properties dialog, set the &#8220;source keywords&#8221; to include &#8216;_translate&#8217;. This allows poedit to find the strings in PsychoPy that are to be translated.</p>
<p>To add paths where Poedit scans .py files, open &#8220;Sources paths&#8221; tab on the Catalog Properties Dialog, and set &#8220;Base path:&#8221; to &#8221;../../../../../&#8221; (= psychopy/psychopy/). Nothing more should be needed.
If you&#8217;ve created new catalog, save your catalog to <cite>psychopy/app/locale/LANG/LC_MESSAGE/messages.po</cite>.</p>
<p>Probably not needed, but check anyway: Edit the file containing language code and name mappings, <cite>psychopy/app/localization/mappings</cite>, and fill in the name for your language. Give a name that should be familiar to people who read that language (i.e., use the name of the language as written in the language itself, not in en_US). About 25 are already done.</p>
</li>
<li><p class="first">Edit a translation:</p>
<p>Open the .po file with Poedit and press &#8220;Update&#8221; button on the toolbar to update newly added / removed strings that need to be translated. Select a string you want to translate and input your translation to &#8220;Translation:&#8221; box. If you are unsure where string is used, point on the string in &#8220;Source text&#8221; box and right-click. You can see where the string is defined.</p>
</li>
<li><p class="first">Technical terms should not be translated: Builder, Coder, PsychoPy, Flow, Routine, and so on. (See the Japanese translation for guidance.)</p>
</li>
<li><p class="first">If there are formatting arguments in the original string (<code class="docutils literal"><span class="pre">%s</span></code>, <code class="docutils literal"><span class="pre">%(first)i</span></code>), the same number of arguments must also appear in the translation (but their order is not constrained to be the original order). If they are named (e.g., <code class="docutils literal"><span class="pre">%(first)i</span></code>), that part should not be translated&#8211;here <code class="docutils literal"><span class="pre">first</span></code> is a python name.</p>
</li>
<li><p class="first">If you think your translation might have room for improvement, indicate that it is &#8220;fuzzy&#8221;. (Saving Notes does not work for me on Mac, seems like a bug in poedit.)</p>
</li>
<li><p class="first">After making a new translation, saving it in poedit will save the .po file and also make an associated .mo file. You need to update the .mo file if you want to see your changes reflected in PsychoPy.</p>
</li>
<li><p class="first">The start-up tips are stored in separate files, and are not translated by poedit. Instead:</p>
</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>copy the default version (named <cite>psychopy/app/Resources/tips.txt</cite>) to a new file in the same directory, named <cite>tips_LANG.txt</cite>. Then replace English-language tips with translated tips. Note that some of the humor might not translate well, so feel free to leave out things that would be too odd, or include occasional mild humor that would be more appropriate. Humor must be respectful and suitable for using in a classroom, laboratory, or other professional situation. Don&#8217;t get too creative here. If you have any doubt, best leave it out. (Hopefully it goes without saying that you should avoid any religious, political, disrespectful, or sexist material.)</li>
<li>in poedit, translate the file name: translate &#8220;tips.txt&#8221; as &#8220;tips_LANG.txt&#8221;</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Commit both the .po and .mo files to github (not just one or the other), and any changed files (e.g., <cite>tips_LANG</cite>, <cite>localization/mappings</cite>).</li>
</ul>
</div>
<div class="section" id="adjust-psychopy-s-code">
<h2>Adjust PsychoPy&#8217;s code<a class="headerlink" href="#adjust-psychopy-s-code" title="Permalink to this headline">¶</a></h2>
<p>This is mostly complete (as of 1.81.00), but will be needed for new code that displays text to users of the app (experimenters, not study participants).</p>
<p>There are a few things to keep in mind when working on the app&#8217;s code to make it compatible with translations. If you are only making a translation, you can skip this section.</p>
<ul class="simple">
<li>In PsychoPy&#8217;s code, the language to be used should always be English with American spellings (e.g., &#8220;color&#8221;).</li>
<li>Within the app, the return value from <code class="docutils literal"><span class="pre">_translate()</span></code> should be used only for display purposes: in menus, tooltips, etc. A translated value should never be used as part of the logic or internal functioning of PsychoPy. It is purely a &#8220;skin&#8221;. Internally, everything must be in en_US.</li>
<li>Basic usage is exactly what you expect: <code class="docutils literal"><span class="pre">_translate(&quot;hello&quot;)</span></code> will return a unicode string at run-time, using mappings for the current locale as provided by a translator in a .mo file. (Not all translations are available yet, see above to start a new one.) To have the app display a translated string to the experimenter, just display the return value from the underscore translation function.</li>
<li>The strings to be translated must appear somewhere in the app code base as explicit strings within <code class="docutils literal"><span class="pre">_translate()</span></code>. If you need to translate a variable, e.g., named <code class="docutils literal"><span class="pre">str_var</span></code> using the expression <code class="docutils literal"><span class="pre">_translate(str_var)</span></code>, somewhere else you need to explicitly give all the possible values that <code class="docutils literal"><span class="pre">str_var</span></code> can take, and enclose each of them within the translate function. It is okay for that to be elsewhere, even in another file, but not in a comment. This allows poedit to discover of all the strings that need to be translated. (This is one of the purposes of the <cite>_localized</cite> dict at the top of some modules.)</li>
<li><code class="docutils literal"><span class="pre">_translate()</span></code> should not be given a null string to translate; if you use a variable, check that it is not &#8216;&#8217; to avoid invoking <code class="docutils literal"><span class="pre">_translate('')</span></code>.</li>
<li>Strings that contain formatting placeholders (e.g., %d, %s, %.4f) require a little more thought. Single placeholders are easy enough: <code class="docutils literal"><span class="pre">_translate(&quot;hello,</span> <span class="pre">%s&quot;)</span> <span class="pre">%</span> <span class="pre">name</span></code>.</li>
<li>Strings with multiple formatting placeholders require named arguments, because positional arguments are not always sufficient to disambiguate things depending on the phrase and the language to be translated into: <code class="docutils literal"><span class="pre">_translate(&quot;hello,</span> <span class="pre">%(first)s</span> <span class="pre">%(last)s&quot;)</span> <span class="pre">%</span> <span class="pre">{'first':</span> <span class="pre">firstname,</span> <span class="pre">'last':</span> <span class="pre">lastname}</span></code></li>
<li>Localizing drop-down menus is a little more involved. Such menus should display localized strings, but return selected values as integers (<code class="docutils literal"><span class="pre">GetSelection()</span></code> returns the position within the list). Do not use <code class="docutils literal"><span class="pre">GetStringSelection()</span></code>, because this will return the localized string, breaking the rule about a strict separation of display and logic. See Builder ParamDialogs for examples.</li>
</ul>
</div>
<div class="section" id="other-notes">
<h2>Other notes<a class="headerlink" href="#other-notes" title="Permalink to this headline">¶</a></h2>
<p>When there are more translations (and if they make the app download large) we might want to manage things differently (e.g., have translations as a separate download from the app).</p>
</div>
</div>


          </div>
          <div class="container"><div id="SOHUCS"></div>
			<script charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/changyan.js" ></script>
			<script type="text/javascript">
			window.changyan.api.config({
			appid: 'cysqnjGqk',
			conf: 'prod_023698c59c1b0d0e29687979a2d2e9a3'
			});
			</script>
		  </div>
        </div>
      </div>

      <div class="clearer"></div>
      
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="menuitem.html" title="Adding a new Menu Item"
             >next</a> |</li>
        <li class="right" >
          <a href="demoStyleGuide.html" title="Style-guide for coder demos"
             >previous</a> |</li>
        <li><a href="../index.html">PsychoPy</a> &raquo;</li>
          <li><a href="../documentation.html" >Documentation</a> &raquo;</li>
          <li><a href="developers.html" >For Developers</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2015, Jonathan Peirce.
      Last updated on Mar 08, 2018.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>